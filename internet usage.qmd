---
title: "Internet Usage"
author: "Arina and Khushi"
format: 
  html: default
  pdf: default
code-fold: true
---

Configuration

```{r}
#| message: false
library(here)
here::i_am("G11-Internet-Usage.Rproj")
library(vroom)
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
```

## Data Loading

```{r}
#| message: false
#| warning: false
co_usage <- vroom(here("data", "EuroStat-full-internet-use.csv"))
co_broadband <- vroom(here("data", "EuroStat-broadband-coverage-speed.csv"))
co_house_access <- vroom(here("data", "EuroStat-household-internet-access.csv"))
reg_broadband <- vroom(here("data", "OECD-regional-internet-broadband.csv"))
reg_int_access <- vroom(here("data", "EuroStat-regional-internet-access.csv"))
reg_int_use <- vroom(here("data", "EuroStat-regional-internet-usage.csv"))
reg_shopping <- vroom(here("data", "EuroStat-regional-goods-services.csv"))
```

# Description

## Links

### Git

Git-hub Project: [G11-Internet-Usage](https://github.com/khushiijain/G11-Internet-Usage)

### Data Sources

***Region-Level Data***

[Households that have internet access at home by NUTS 2 regions:]{.underline} [reg_int_access](https://ec.europa.eu/eurostat/databrowser/view/tgs00047/default/table?lang=en)

The access of households to internet is measured as percentage of households where any member of the household has the possibility to access the internet from home.Â 

[Individuals who ordered goods or services over the internet for private use in the last year by NUTS 2 regions:]{.underline} [reg_shopping](https://ec.europa.eu/eurostat/databrowser/view/tgs00052/default/map?lang=en)

Persons who bought or ordered goods or services (i.e. food, groceries, household goods, films, music, books, magazines, newspapers, clothes, sports goods, computer software or hardware, electronic equipment, shares, financial services, insurances, travel or holiday accommodation, tickets, lotteries or betting and other) over the internet during the last year.

[Individuals regularly using the internet by NUTS 2 regions:]{.underline} [red_int_use](https://ec.europa.eu/eurostat/databrowser/view/tgs00050/default/table?lang=en)

Regular users of the internet are persons who use the internet on average at least once a week, every day or almost every day.

***OECD:***

Website reach: Regional Demography -\> Regional Social and Environmental indicators -\> Internet broadband access: [reg_broadband](https://stats.oecd.org/Index.aspx?DataSetCode=REGION_DEMOGR#)

The data is available for many countries and we selected 29 European countries. To filter on the OECD website, we must go to the ***Customise*** -\> ***Selection -\> Region*** and select the 29 countries and their regions.

\
***Country-Level Data***

[Link for data source of custom dataset for 'Individuals - internet activities' (all relevant variables selected\*):]{.underline} [co_usage](https://ec.europa.eu/eurostat/databrowser/view/ISOC_CI_AC_I__custom_8519721/default/table?lang=en&page=time:2022)

['Broadband internet coverage by speed']{.underline}: [co_broadband](https://ec.europa.eu/eurostat/databrowser/view/isoc_cbs__custom_8519699/default/table?lang=en)

['Level of internet access - households']{.underline}: [co_house_access](https://ec.europa.eu/eurostat/databrowser/view/tin00134__custom_8520113/default/table?lang=en)

Percentage of households who have internet access at home. All forms of internet use are included. The population considered is aged 16 to 74.


### Variable Description

```{r function_region_ID}
reformatting_region <- function(int_df) {
region_ids <- int_df |>
  distinct(geo, `Geopolitical entity (reporting)`) |>
  rename(REG_ID = geo, Region = `Geopolitical entity (reporting)`)
}
```

**Region-Level Data Description**

We possess region-level data from OECD and Eurostat, where the region IDs are specified using country initials and a unique number allotted to each region.

[NUTS 2 Regions EuroStat]{.underline}

```{r}
kable(head(reg_int_use_reg_id <- reg_int_use |> 
             reformatting_region()), 
      caption = "First 6 rows of EuroStat Region IDs and Names", 
      align = "cc")
```

[Territory level and region ID OECD]{.underline}

Where Territorial Level 1 represents a country, and 2 represents states and regions.
```{r}
kable(head(reg_id_reg_broadband <- reg_broadband |>
  distinct(Region, REG_ID, TL) |>
  group_by(REG_ID),
  caption = "First 6 rows of Region IDs and Names"))
```

This following table establishes the connection between OECD regions and NUTS regions using the `inner_join` function.

```{r}
kable(head(reg_ids <- reg_id_reg_broadband |>
             select(-TL) |>
             inner_join(reg_int_use_reg_id, 
                        by = join_by(REG_ID), 
                        suffix = c("_OECD", "_EuroStat")), 
           caption = "First 6 rows of Region IDs and Names"))
```

**Country-Level Data Description**

The country-level data comprises 15 variables analyzing various types of internet usage, such as seeking health information, online learning, and music streaming. The following tables represents the country codes, indicator codes and associated information.


```{r}
kable(country_ids <- co_broadband |>
  distinct(geo, `Geopolitical entity (reporting)`) |>
  rename(REG_ID = geo, Country = `Geopolitical entity (reporting)`))
```

```{r}
kable(
  indicator_id_co_usage <- co_usage |>
  distinct(indic_is, `Information society indicator`) |>
  group_by(indic_is)
)
```

Our internet usage data is categorized based on individuals' different ages, sexes, and employment statuses.

```{r}
kable(
individual_type_co_usage <- co_usage |>
  distinct(ind_type, `Individual type`) |>
  group_by(ind_type)
)
```





### Basic Information

```{r function_table}
basic_table <- function(.x) {
.x |> 
        summarise(nrow(.x), ncol(.x))
}
```

```{r kables}
kable((co_usage |> basic_table()), caption = "Internet Usage - Country", align = "cc")
kable((co_broadband |> basic_table()), caption = "Broadband Access - Country", align = "cc")
kable((co_house_access |> basic_table()), caption = "Internet Access - Country", align = "cc")
kable((reg_broadband |> basic_table()), caption = "Broadband Access - Region", align = "cc")
kable((reg_int_access |> basic_table()), caption = "Internet Access - Region", align = "cc")
kable((reg_int_use |> basic_table()), caption = "Regular Internet Use - Region", align = "cc")
kable((reg_shopping |> basic_table()), caption = "Internet use for buying Goods and Services - Region", align = "cc")

```




# Cleaning

For ease of cleaning, multiple functions have been created.
```{r single_value_function}
single_value <- function(my_var) {
  (my_var |> unique() |> length()) ==1
}
```

## Formatting OECD data
```{r}
reg_broadband <- reg_broadband |>
  select(-where(anyNA), -where(single_value), -TIME, -TL, -`Territory level and Typology`, -Region)
```
This code removes the unnecessary columns, leaving the OECD regional broadband access data to consist of the Regional ID, Year, and percentage Value.

## Formatting EuroStat regional data
``` {r regional_basic_function}
reformatting <- function(int_df) {
int <- int_df |>
  select(-where(single_value), -`Observation status (Flag)`, -OBS_FLAG) |>
  select(!where(\(.x) all(is.na(.x)))) |>
  rename(REG_ID = geo, 
         Region = `Geopolitical entity (reporting)`,
         Year = TIME_PERIOD,
         Value = OBS_VALUE) |>
  select(-Region)
}
```


``` {r}
reg_int_use <- reg_int_use |> reformatting()
reg_int_access <- reg_int_access |> reformatting()
reg_shopping <- reg_shopping |> reformatting()
```
Data for regional "Individual regular internet use", "Internet access", and "Goods and services shopping" also now contain only the Regional ID, Year, and Value variables.


## Formatting EuroStat country data

```{r}
co_house_access <- co_house_access |> reformatting()
```
Reformatting is done, same as previously, for country level Internet access.

```{r}
co_broadband <- co_broadband |> reformatting()
co_broadband <- co_broadband |>
  select(-`Internet speed`) |>
  pivot_wider(names_from = inet_spd, values_from = Value)
```
Country level broadband access speed is reformatted and pivoted to display the different speeds as additional variables


### Formatting EuroStat full internet usage dataset by country 

First, a function is created to split the dataset into comprehensible country, indicator, and individual type codes, as well as removal of unnecessary columns. Then, pivoting the data allows for further separation by Sex and Employment status. All these datasets are places in a list.
``` {r internet_usage_split_function}
reformatting_full <- function(int_df) {
  
country_ids <- int_df |>
  distinct(geo, `Geopolitical entity (reporting)`) |>
  rename(REG_ID = geo, Region = `Geopolitical entity (reporting)`)

indicators <- int_df |>
  distinct(indic_is, `Information society indicator`) 

individuals <- int_df |>
  distinct(ind_type, `Individual type`) 

int_full <- int_df |> reformatting()
int_full <- int_full |>
  select(-`Information society indicator`, -`Individual type`)

int_wide <- int_full |>
  pivot_wider(names_from = ind_type, values_from = Value)

int_female <- int_wide |>
  select(indic_is, REG_ID, Year, starts_with("F_"))

int_male <- int_wide |>
  select(indic_is, REG_ID, Year, starts_with("M_"))

int_emp <- int_wide |>
  select(indic_is, REG_ID, Year, RETIR_OTHER, SAL_SELF_FAM, STUD, UNE)

list(country_ids = country_ids,
     indicators = indicators,
     individuals = individuals,
     internet = int_full, 
     int_wide = int_wide,
     int_female = int_female,
     int_male = int_male,
     int_emp = int_emp)
}
```

```{r}
co_usage <- co_usage |> reformatting_full()
```









